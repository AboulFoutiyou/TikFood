<ion-header [translucent]="true">
  <ion-toolbar color="success">
    <ion-buttons slot="start">
      <ion-button fill="clear" (click)="goBack()">
        <ion-icon name="chevron-back" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Statistiques & Historique</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="analytics-content" *ngIf="analytics">
  <!-- Overview Stats -->
  <div class="stats-overview">
    <ion-grid>
      <ion-row>
        <ion-col size="6">
          <ion-card class="stat-card total-orders">
            <ion-card-content>
              <div class="stat-content">
                <ion-icon name="bag-handle-outline" class="stat-icon"></ion-icon>
                <div class="stat-info">
                  <div class="stat-value">{{ analytics.totalOrders }}</div>
                  <div class="stat-label">Total commandes</div>
                </div>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="6">
          <ion-card class="stat-card total-revenue">
            <ion-card-content>
              <div class="stat-content">
                <ion-icon name="cash-outline" class="stat-icon"></ion-icon>
                <div class="stat-info">
                  <div class="stat-value">{{ formatPrice(analytics.totalRevenue) }}</div>
                  <div class="stat-label">Revenus totaux</div>
                </div>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col size="6">
          <ion-card class="stat-card today-orders">
            <ion-card-content>
              <div class="stat-content">
                <ion-icon name="time-outline" class="stat-icon"></ion-icon>
                <div class="stat-info">
                  <div class="stat-value">{{ analytics.todayOrders }}</div>
                  <div class="stat-label">Aujourd'hui</div>
                </div>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="6">
          <ion-card class="stat-card today-revenue">
            <ion-card-content>
              <div class="stat-content">
                <ion-icon name="trending-up-outline" class="stat-icon"></ion-icon>
                <div class="stat-info">
                  <div class="stat-value">{{ formatPrice(analytics.todayRevenue) }}</div>
                  <div class="stat-label">Revenus du jour</div>
                </div>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <!-- Weekly Charts -->
  <div class="charts-section">
    <!-- Weekly Orders Chart -->
    <ion-card class="chart-card">
      <ion-card-content>
        <div class="chart-header">
          <h3>Commandes cette semaine</h3>
          <div class="chart-total">{{ getTotalWeeklyOrders() }} commandes</div>
        </div>
        <div class="bar-chart">
          <div class="chart-bars">
            <div 
              *ngFor="let orders of analytics.weeklyOrders; let i = index" 
              class="bar-container">
              <div 
                class="bar orders-bar"
                [style.height.%]="getBarHeight(orders, getMaxWeeklyValue(analytics.weeklyOrders))">
              </div>
              <div class="bar-value">{{ orders }}</div>
              <div class="bar-label">{{ weekDays[i] }}</div>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Weekly Revenue Chart -->
    <ion-card class="chart-card">
      <ion-card-content>
        <div class="chart-header">
          <h3>Revenus cette semaine</h3>
          <div class="chart-total">{{ formatPrice(getTotalWeeklyRevenue()) }}</div>
        </div>
        <div class="bar-chart">
          <div class="chart-bars">
            <div 
              *ngFor="let revenue of analytics.weeklyRevenue; let i = index" 
              class="bar-container">
              <div 
                class="bar revenue-bar"
                [style.height.%]="getBarHeight(revenue, getMaxWeeklyValue(analytics.weeklyRevenue))">
              </div>
              <div class="bar-value">{{ revenue > 0 ? (revenue / 1000).toFixed(0) + 'k' : '0' }}</div>
              <div class="bar-label">{{ weekDays[i] }}</div>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Top Products -->
  <div class="top-products-section" *ngIf="analytics.topProducts.length > 0">
    <ion-card class="top-products-card">
      <ion-card-content>
        <div class="section-header">
          <h3>Produits les plus vendus</h3>
          <ion-icon name="bar-chart-outline"></ion-icon>
        </div>
        <div class="products-list">
          <div 
            *ngFor="let product of analytics.topProducts; let i = index" 
            class="product-item">
            <div class="product-rank">{{ i + 1 }}</div>
            <div class="product-info">
              <div class="product-name">{{ product.name }}</div>
              <div class="product-stats">
                <span class="orders-count">{{ product.orders }} commandes</span>
                <span class="revenue-amount">{{ formatPrice(product.revenue) }}</span>
              </div>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Orders by Status -->
  <div class="status-section" *ngIf="analytics.ordersByStatus.length > 0">
    <ion-card class="status-card">
      <ion-card-content>
        <div class="section-header">
          <h3>RÃ©partition des commandes</h3>
          <ion-icon name="pie-chart-outline"></ion-icon>
        </div>
        <div class="status-list">
          <div 
            *ngFor="let statusItem of analytics.ordersByStatus" 
            class="status-item">
            <ion-chip [color]="getStatusColor(statusItem.status)" class="status-chip">
              <ion-label>{{ getStatusLabel(statusItem.status) }}</ion-label>
            </ion-chip>
            <div class="status-count">{{ statusItem.count }}</div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>